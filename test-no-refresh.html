<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test No Auto-Refresh</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #network-log { max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Auto-Refresh Prevention Test</h1>
    
    <div id="status" class="status info">
        <strong>Status:</strong> <span id="status-text">Initializing...</span>
    </div>
    
    <div class="status info">
        <strong>Instructions:</strong>
        <ol>
            <li>Open Browser Developer Tools (F12)</li>
            <li>Go to Network tab</li>
            <li>Clear the network log</li>
            <li>Wait for 2 minutes</li>
            <li>Check if any /api/health requests appear every 30 seconds</li>
        </ol>
    </div>
    
    <div class="status info">
        <strong>Network Activity Log:</strong>
        <div id="network-log">Waiting for network activity...</div>
    </div>
    
    <div class="status info">
        <strong>Auto-Refresh Prevention Status:</strong>
        <div id="prevention-status">Loading...</div>
    </div>

    <script>
        let networkRequests = [];
        let startTime = Date.now();
        
        // Monitor network requests
        function logNetworkRequest(url, method, timestamp) {
            const elapsed = Math.round((timestamp - startTime) / 1000);
            const logEntry = `[${elapsed}s] ${method} ${url}`;
            networkRequests.push(logEntry);
            
            const logDiv = document.getElementById('network-log');
            logDiv.innerHTML = networkRequests.slice(-20).join('<br>');
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Check for health endpoint requests
            if (url.includes('/health') || url.includes('/api/health')) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status-text').textContent = `‚ùå Health check detected: ${url}`;
            }
        }
        
        // Override fetch to monitor requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const options = args[1] || {};
            const method = options.method || 'GET';
            
            logNetworkRequest(url, method, Date.now());
            
            return originalFetch.apply(this, args);
        };
        
        // Override XMLHttpRequest to monitor requests
        const originalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new originalXHR();
            const originalOpen = xhr.open;
            
            xhr.open = function(method, url, ...args) {
                logNetworkRequest(url, method, Date.now());
                return originalOpen.apply(this, [method, url, ...args]);
            };
            
            return xhr;
        };
        
        // Update status
        function updateStatus() {
            const elapsed = Math.round((Date.now() - startTime) / 1000);
            const healthRequests = networkRequests.filter(req => req.includes('/health')).length;
            
            if (healthRequests === 0) {
                document.getElementById('status').className = 'status success';
                document.getElementById('status-text').textContent = `‚úÖ No health check requests detected (${elapsed}s elapsed)`;
            } else {
                document.getElementById('status').className = 'status error';
                document.getElementById('status-text').textContent = `‚ùå ${healthRequests} health check requests detected`;
            }
            
            // Update prevention status
            if (window.autoRefreshPrevention) {
                const status = window.autoRefreshPrevention.getStatus();
                document.getElementById('prevention-status').innerHTML = `
                    <strong>Enabled:</strong> ${status.isEnabled}<br>
                    <strong>Blocked Intervals:</strong> ${status.blockedIntervals}<br>
                    <strong>Blocked Timeouts:</strong> ${status.blockedTimeouts}
                `;
            } else {
                document.getElementById('prevention-status').innerHTML = 'Auto-refresh prevention not loaded';
            }
        }
        
        // Update status every 10 seconds
        setInterval(updateStatus, 10000);
        updateStatus();
        
        // Initial status
        document.getElementById('status-text').textContent = 'Monitoring network activity...';
    </script>
</body>
</html>
